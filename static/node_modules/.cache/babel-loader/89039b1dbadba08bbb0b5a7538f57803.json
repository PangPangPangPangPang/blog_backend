{"ast":null,"code":"import _classCallCheck from \"/home/max/blog_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/max/blog_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/max/blog_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/max/blog_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/max/blog_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/max/blog_frontend/src/container/article/article.js\";\n\n/**\n * Created by Max on 04/03/2017.\n */\nimport React from 'react';\nimport marked from 'marked';\nimport PropTypes from 'prop-types';\nimport hl from 'highlight.js';\nimport { ToastContainer, toast } from 'react-toastify';\nimport { connect } from 'react-redux';\nimport '../../../node_modules/highlight.js/styles/xcode.css';\nimport request from '../../action/request';\nimport { replyComment, clearReplyComment } from '../../action/reply';\nimport updateCurrentArticle from '../../action/user';\nimport './article.css';\nimport { getStore } from '../../App';\nimport Loading from '../../compontent/loading';\nimport Footer from '../footer/footer';\nimport DevImage from '../../resource/jpg/splatoon.png';\nimport Comment from '../../compontent/comment';\nimport Login from '../login/login';\nimport Reply from '../../compontent/reply';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { isPC } from '../../utils/utils';\nvar renderer = new marked.Renderer();\nmarked.setOptions({\n  renderer: renderer,\n  gfm: true,\n  tables: true,\n  breaks: true,\n  pedantic: true,\n  sanitize: true,\n  smartLists: true,\n  smartypants: true\n});\n\nrenderer.code = function (code, language) {\n  var validLang = !!(language && hl.getLanguage(language));\n  var highlighted = validLang ? hl.highlight(language, code).value : code;\n  return \"<pre><code class=\\\"article-code hljs \".concat(language, \"\\\">\").concat(highlighted, \"</code></pre>\");\n};\n\nrenderer.image = function (href, title, text) {\n  var size;\n\n  if (title) {\n    size = title.split('x');\n  }\n\n  if (title) {\n    if (size[1]) {\n      size = \"width=\".concat(size[0], \"height=\").concat(size[1]);\n    } else {\n      size = \"width=\".concat(size[0]);\n    }\n  } else {\n    size = '100%';\n  } // Use placeholder image in the development environment.\n\n\n  var h = href;\n\n  if (process.env.NODE_ENV === 'development') {\n    h = DevImage;\n  }\n\n  return \"<img onclick=\\\"window.open(this.src)\\\" class=\\\"article-img\\\" src=\\\"\".concat(h, \"\\\" width=\\\"100%\\\" height=\\\"auto\\\" alt=\").concat(text, \"/>\");\n};\n\nvar articleObject;\n\nrenderer.heading = function heading(text, level) {\n  var font = 30 - level * 3;\n\n  if (level === 1) {\n    var timeStr = \"<div style=\\\"background-color: #D0104C;padding-left: 7px; padding-right: 7px; padding-bottom:3px; padding-top: 3px; margin-right: 10px; border-radius: 2px; color: white; font-size: 13px\\\">\\n                      \".concat(articleObject.time, \"\\n                    </div>\");\n    return \"<div>\\n              <div class=\\\"article-head\\\" style=\\\"font-size: \".concat(font, \"px;margin-bottom: 10px;margin-top: 30px;padding-bottom: 8px\\\">\\n                <strong>\").concat(text, \"</strong>\\n              </div>\\n              <div style=\\\"margin-bottom:10px;font-weight: bold;display: flex;\\\">\\n                \").concat(timeStr, \"\\n              </div>\\n            </div>\");\n  }\n\n  return \"<div class=\\\"article-head\\\" style=\\\"font-size: \".concat(font, \"px;margin-bottom: 10px;margin-top: 30px;padding-bottom: 8px\\\">\\n            <strong>\").concat(text, \"</strong>\\n          </div>\");\n};\n\nrenderer.strong = function strong(text) {\n  return \"<strong>\".concat(text, \"</strong>\");\n};\n\nrenderer.paragraph = function paragraph(text) {\n  return \"<div class=\\\"article-paragraph\\\">\".concat(text, \"</div>\");\n};\n\nrenderer.list = function list(body, ordered) {\n  var t = ordered ? 'decimal' : 'disc';\n  return \"<ul style=\\\"list-style-type: \".concat(t, \"; margin-top: 0.6em; font-size: 15px; margin-bottom: 1.3em;\\\">\").concat(body, \"</ul>\");\n};\n\nrenderer.listitem = function listitem(text) {\n  return \"<li style=\\\"margin-bottom: 0.3em;\\\">\".concat(text, \"</li>\");\n};\n\nrenderer.blockquote = function em(text) {\n  return \"<blockquote class='article-blockquote'>\".concat(text, \"</blockquote>\");\n};\n\nrenderer.codespan = function code(text) {\n  return \"<code class=\\\"article-codespan\\\">\".concat(text, \"</code>\");\n};\n\nvar Article =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Article, _React$Component);\n\n  function Article() {\n    var _this;\n\n    _classCallCheck(this, Article);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Article).call(this));\n\n    _this.onClickReply = function (args) {\n      var _this$props = _this.props,\n          dispatch = _this$props.dispatch,\n          isLoggedin = _this$props.isLoggedin;\n\n      if (!isLoggedin) {\n        _this.setState({\n          login: React.createElement(Login, {\n            onLoginSuccess: _this.onLoginSuccess,\n            onClickCancel: _this.onLoginCancel,\n            onLoginFailure: _this.onLoginFailure,\n            show: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 145\n            },\n            __self: this\n          })\n        });\n      } else {\n        dispatch(replyComment(args.commentId));\n      }\n    };\n\n    _this.onClickConfirm = function (args) {\n      var _this$props2 = _this.props,\n          dispatch = _this$props2.dispatch,\n          isLoggedin = _this$props2.isLoggedin;\n\n      if (!isLoggedin) {\n        _this.setState({\n          login: React.createElement(Login, {\n            onLoginSuccess: _this.onLoginSuccess,\n            onClickCancel: _this.onLoginCancel,\n            onLoginFailure: _this.onLoginFailure,\n            show: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 163\n            },\n            __self: this\n          })\n        });\n\n        return;\n      }\n\n      var params = _this.props.params;\n      var articleID = params.id;\n      var uuid = window.localStorage.uuid;\n      var reply = args.reply,\n          commentId = args.commentId;\n      var form = new FormData();\n      form.append('article_id', articleID);\n      form.append('uuid', uuid);\n      form.append('content', reply);\n      form.append('parent_id', commentId);\n      dispatch(request('addcomment', form, 'post')).then(function (res) {\n        var errormsg = res.errormsg,\n            errorcode = res.errorcode;\n\n        if (errorcode === 0) {\n          var commentArgs = {};\n          commentArgs.article_id = params.id;\n          dispatch(request('fetchcomment', commentArgs, 'get'));\n          dispatch(clearReplyComment());\n        } else {\n          toast(errormsg, {\n            position: toast.POSITION.BOTTOM_CENTER\n          });\n        }\n      }).catch(function () {});\n    };\n\n    _this.getFooter = function () {\n      var displayLoading = _this.props.displayLoading;\n\n      if (displayLoading === 0) {\n        return React.createElement(Footer, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 202\n          },\n          __self: this\n        });\n      }\n\n      return null;\n    };\n\n    _this.getComments = function () {\n      var root = _this.generateCommentNodeTree();\n\n      if (root === null) {\n        return null;\n      }\n\n      var list = [];\n\n      for (var i = 0; i < root.children.length; i += 1) {\n        var node = root.children[i];\n\n        var comment = _this.generateCommentComponent(node);\n\n        list.push(comment);\n      }\n\n      var pageClass = _this.state.pageClass;\n      return React.createElement(\"div\", {\n        className: pageClass,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, list);\n    };\n\n    _this.generateCommentComponent = function (node) {\n      var commentID = _this.props.commentID;\n      var content = node.content,\n          name = node.name,\n          blog = node.blog;\n      var iconUrl = node.icon_url;\n      var createDate = node.create_date;\n      var currentCommentID = node.comment_id;\n      var component = React.createElement(Comment, {\n        key: currentCommentID,\n        commentId: currentCommentID,\n        content: content,\n        name: name,\n        iconUrl: iconUrl,\n        showReply: commentID === currentCommentID,\n        blog: blog,\n        createDate: createDate,\n        clickReply: _this.onClickReply,\n        subcomponent: node.children,\n        onClickConfirm: _this.onClickConfirm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      });\n      return component;\n    };\n\n    _this.onLoginSuccess = function () {\n      toast('愉快的py吧！', {\n        position: toast.POSITION.BOTTOM_CENTER\n      });\n\n      _this.setState({\n        login: null\n      });\n    };\n\n    _this.onLoginCancel = function () {\n      _this.setState({\n        login: null\n      });\n    };\n\n    _this.onLoginFailure = function (errormsg) {\n      toast(errormsg, {\n        position: toast.POSITION.BOTTOM_CENTER\n      });\n    };\n\n    _this.generateCommentNodeTree = function () {\n      var comments = _this.props.comments;\n\n      if (comments === null || comments.length === 0) {\n        return null;\n      }\n\n      var root = {\n        parent_id: -1,\n        children: []\n      };\n      var map = {};\n      map[-1] = root;\n      Object.keys(comments).forEach(function (index) {\n        var comment = comments[index];\n        comment.children = [];\n        var commentId = comment.comment_id;\n\n        if (commentId !== undefined) {\n          map[commentId] = comment;\n        }\n      });\n      Object.keys(comments).forEach(function (index) {\n        var comment = comments[index];\n        var parentId = comment.parent_id;\n        var parent = map[parentId];\n        parent.children.push(comment);\n      });\n      return root;\n    };\n\n    _this.state = {\n      login: null,\n      pageClass: \"article-page \".concat(isPC() ? 'article-page-pc' : 'article-page-phone')\n    };\n    return _this;\n  }\n\n  _createClass(Article, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.scrollTo(0, 0);\n      var _this$props3 = this.props,\n          dispatch = _this$props3.dispatch,\n          params = _this$props3.params;\n      var dic = {\n        id: params.id\n      };\n      var store = getStore();\n\n      if (store.getState().request[params.id]) {\n        return;\n      }\n\n      var commentArgs = {};\n      var articleID = params.id;\n      commentArgs.article_id = articleID;\n      dispatch(updateCurrentArticle(articleID));\n      dispatch(request('article', dic, 'get'));\n      dispatch(request('fetchcomment', commentArgs, 'get'));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n          args = _this$props4.args,\n          displayLoading = _this$props4.displayLoading,\n          content = _this$props4.content;\n      var _this$state = this.state,\n          login = _this$state.login,\n          pageClass = _this$state.pageClass;\n      articleObject = args;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: pageClass,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }, React.createElement(Loading, {\n        show: displayLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: marked(content)\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: pageClass,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304\n        },\n        __self: this\n      }, React.createElement(Reply, {\n        clickConfirm: this.onClickConfirm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      })), this.getComments(), this.getFooter(), login, React.createElement(ToastContainer, {\n        autoClose: 1000,\n        closeButton: React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312\n          },\n          __self: this\n        }),\n        hideProgressBar: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Article;\n}(React.Component);\n\nArticle.propTypes = {\n  dispatch: PropTypes.func,\n  content: PropTypes.string,\n  params: PropTypes.object,\n  // eslint-disable-line react/forbid-prop-types\n  args: PropTypes.object,\n  // eslint-disable-line react/forbid-prop-types\n  displayLoading: PropTypes.number,\n  comments: PropTypes.array,\n  // eslint-disable-line react/forbid-prop-types\n  commentID: PropTypes.number,\n  isLoggedin: PropTypes.bool\n};\nArticle.defaultProps = {\n  dispatch: {},\n  params: {},\n  args: {},\n  content: '',\n  displayLoading: 1,\n  comments: [],\n  commentID: -1,\n  isLoggedin: false\n};\n\nfunction mapStateToProps(state, ownProps) {\n  var getShow = function getShow() {\n    var articleId = ownProps.params.id;\n\n    if (state.request[articleId]) {\n      return 0;\n    }\n\n    return 1;\n  };\n\n  var getContent = function getContent() {\n    var articleId = ownProps.params.id;\n\n    if (state.request[articleId]) {\n      return state.request[articleId].content;\n    }\n\n    return '';\n  };\n\n  var getArgs = function getArgs() {\n    var articleId = ownProps.params.id;\n\n    if (state.request[articleId]) {\n      return state.request[articleId];\n    }\n\n    return {};\n  };\n\n  var getComments = function getComments() {\n    var articleId = ownProps.params.id;\n\n    if (state.request[articleId]) {\n      return state.request[articleId].comments;\n    }\n\n    return [];\n  };\n\n  var getCommentID = function getCommentID() {\n    var commentID = state.reply.commentID;\n\n    if (commentID === undefined) {\n      return -1;\n    }\n\n    return commentID;\n  }; // 获取登录状态\n\n\n  var getLoginStatus = function getLoginStatus() {\n    var storage = window.localStorage; // 获取storage中缓存的uuid\n\n    var uuid = storage.uuid;\n\n    if (uuid === undefined || uuid.length === 0) {\n      if (state.request.register === undefined) {\n        return false;\n      } // 获取从登录response中获得的uuid\n\n\n      var suuid = state.request.register.uuid;\n\n      if (suuid === undefined || suuid.length === 0) {\n        return false;\n      }\n\n      storage.uuid = suuid;\n    }\n\n    return true;\n  };\n\n  return {\n    content: getContent(),\n    displayLoading: getShow(),\n    args: getArgs(),\n    comments: getComments(),\n    commentID: getCommentID(),\n    isLoggedin: getLoginStatus()\n  };\n}\n\nexport default connect(mapStateToProps)(Article);","map":{"version":3,"sources":["/home/max/blog_frontend/src/container/article/article.js"],"names":["React","marked","PropTypes","hl","ToastContainer","toast","connect","request","replyComment","clearReplyComment","updateCurrentArticle","getStore","Loading","Footer","DevImage","Comment","Login","Reply","isPC","renderer","Renderer","setOptions","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","code","language","validLang","getLanguage","highlighted","highlight","value","image","href","title","text","size","split","h","process","env","NODE_ENV","articleObject","heading","level","font","timeStr","time","strong","paragraph","list","body","ordered","t","listitem","blockquote","em","codespan","Article","onClickReply","args","props","dispatch","isLoggedin","setState","login","onLoginSuccess","onLoginCancel","onLoginFailure","commentId","onClickConfirm","params","articleID","id","uuid","window","localStorage","reply","form","FormData","append","then","res","errormsg","errorcode","commentArgs","article_id","position","POSITION","BOTTOM_CENTER","catch","getFooter","displayLoading","getComments","root","generateCommentNodeTree","i","children","length","node","comment","generateCommentComponent","push","pageClass","state","commentID","content","name","blog","iconUrl","icon_url","createDate","create_date","currentCommentID","comment_id","component","comments","parent_id","map","Object","keys","forEach","index","undefined","parentId","parent","scrollTo","dic","store","getState","__html","Component","propTypes","func","string","object","number","array","bool","defaultProps","mapStateToProps","ownProps","getShow","articleId","getContent","getArgs","getCommentID","getLoginStatus","storage","register","suuid"],"mappings":"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","sourcesContent":["/**\n * Created by Max on 04/03/2017.\n */\nimport React from 'react'\nimport marked from 'marked'\nimport PropTypes from 'prop-types'\nimport hl from 'highlight.js'\nimport { ToastContainer, toast } from 'react-toastify'\nimport { connect } from 'react-redux'\nimport '../../../node_modules/highlight.js/styles/xcode.css'\nimport request from '../../action/request'\nimport { replyComment, clearReplyComment } from '../../action/reply'\nimport updateCurrentArticle from '../../action/user'\nimport './article.css'\nimport { getStore } from '../../App'\nimport Loading from '../../compontent/loading'\nimport Footer from '../footer/footer'\nimport DevImage from '../../resource/jpg/splatoon.png'\nimport Comment from '../../compontent/comment'\nimport Login from '../login/login'\nimport Reply from '../../compontent/reply'\nimport 'react-toastify/dist/ReactToastify.css'\nimport { isPC } from '../../utils/utils'\n\nconst renderer = new marked.Renderer()\n\nmarked.setOptions({\n  renderer,\n  gfm: true,\n  tables: true,\n  breaks: true,\n  pedantic: true,\n  sanitize: true,\n  smartLists: true,\n  smartypants: true,\n})\n\nrenderer.code = (code, language) => {\n  const validLang = !!(language && hl.getLanguage(language))\n  const highlighted = validLang ? hl.highlight(language, code).value : code\n  return `<pre><code class=\"article-code hljs ${language}\">${highlighted}</code></pre>`\n}\n\nrenderer.image = (href, title, text) => {\n  let size\n  if (title) {\n    size = title.split('x')\n  }\n  if (title) {\n    if (size[1]) {\n      size = `width=${size[0]}height=${size[1]}`\n    } else {\n      size = `width=${size[0]}`\n    }\n  } else {\n    size = '100%'\n  }\n  // Use placeholder image in the development environment.\n  let h = href\n  if (process.env.NODE_ENV === 'development') {\n    h = DevImage\n  }\n\n  return `<img onclick=\"window.open(this.src)\" class=\"article-img\" src=\"${h}\" width=\"100%\" height=\"auto\" alt=${text}/>`\n}\n\nlet articleObject\nrenderer.heading = function heading(text, level) {\n  const font = 30 - level * 3\n  if (level === 1) {\n    const timeStr = `<div style=\"background-color: #D0104C;padding-left: 7px; padding-right: 7px; padding-bottom:3px; padding-top: 3px; margin-right: 10px; border-radius: 2px; color: white; font-size: 13px\">\n                      ${articleObject.time}\n                    </div>`\n    return `<div>\n              <div class=\"article-head\" style=\"font-size: ${font}px;margin-bottom: 10px;margin-top: 30px;padding-bottom: 8px\">\n                <strong>${text}</strong>\n              </div>\n              <div style=\"margin-bottom:10px;font-weight: bold;display: flex;\">\n                ${timeStr}\n              </div>\n            </div>`\n  }\n  return `<div class=\"article-head\" style=\"font-size: ${font}px;margin-bottom: 10px;margin-top: 30px;padding-bottom: 8px\">\n            <strong>${text}</strong>\n          </div>`\n}\n\nrenderer.strong = function strong(text) {\n  return `<strong>${text}</strong>`\n}\n\nrenderer.paragraph = function paragraph(text) {\n  return `<div class=\"article-paragraph\">${text}</div>`\n}\n\nrenderer.list = function list(body, ordered) {\n  const t = ordered ? 'decimal' : 'disc'\n  return `<ul style=\"list-style-type: ${t}; margin-top: 0.6em; font-size: 15px; margin-bottom: 1.3em;\">${body}</ul>`\n}\n\nrenderer.listitem = function listitem(text) {\n  return `<li style=\"margin-bottom: 0.3em;\">${text}</li>`\n}\n\nrenderer.blockquote = function em(text) {\n  return `<blockquote class='article-blockquote'>${text}</blockquote>`\n}\n\nrenderer.codespan = function code(text) {\n  return `<code class=\"article-codespan\">${text}</code>`\n}\n\nclass Article extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      login: null,\n      pageClass: `article-page ${\n        isPC() ? 'article-page-pc' : 'article-page-phone'\n      }`,\n    }\n  }\n\n  componentDidMount() {\n    window.scrollTo(0, 0)\n    const { dispatch, params } = this.props\n    const dic = { id: params.id }\n    const store = getStore()\n    if (store.getState().request[params.id]) {\n      return\n    }\n    const commentArgs = {}\n    const articleID = params.id\n    commentArgs.article_id = articleID\n    dispatch(updateCurrentArticle(articleID))\n    dispatch(request('article', dic, 'get'))\n    dispatch(request('fetchcomment', commentArgs, 'get'))\n  }\n\n  onClickReply = (args) => {\n    const { dispatch, isLoggedin } = this.props\n    if (!isLoggedin) {\n      this.setState({\n        login: (\n          <Login\n            onLoginSuccess={this.onLoginSuccess}\n            onClickCancel={this.onLoginCancel}\n            onLoginFailure={this.onLoginFailure}\n            show\n          />\n        ),\n      })\n    } else {\n      dispatch(replyComment(args.commentId))\n    }\n  };\n\n  onClickConfirm = (args) => {\n    const { dispatch, isLoggedin } = this.props\n    if (!isLoggedin) {\n      this.setState({\n        login: (\n          <Login\n            onLoginSuccess={this.onLoginSuccess}\n            onClickCancel={this.onLoginCancel}\n            onLoginFailure={this.onLoginFailure}\n            show\n          />\n        ),\n      })\n      return\n    }\n    const { params } = this.props\n    const articleID = params.id\n    const { uuid } = window.localStorage\n    const { reply, commentId } = args\n    const form = new FormData()\n    form.append('article_id', articleID)\n    form.append('uuid', uuid)\n    form.append('content', reply)\n    form.append('parent_id', commentId)\n    dispatch(request('addcomment', form, 'post'))\n      .then((res) => {\n        const { errormsg, errorcode } = res\n        if (errorcode === 0) {\n          const commentArgs = {}\n          commentArgs.article_id = params.id\n          dispatch(request('fetchcomment', commentArgs, 'get'))\n          dispatch(clearReplyComment())\n        } else {\n          toast(errormsg, {\n            position: toast.POSITION.BOTTOM_CENTER,\n          })\n        }\n      })\n      .catch(() => {})\n  };\n\n  getFooter = () => {\n    const { displayLoading } = this.props\n    if (displayLoading === 0) {\n      return <Footer />\n    }\n    return null\n  };\n\n  getComments = () => {\n    const root = this.generateCommentNodeTree()\n    if (root === null) {\n      return null\n    }\n    const list = []\n    for (let i = 0; i < root.children.length; i += 1) {\n      const node = root.children[i]\n      const comment = this.generateCommentComponent(node)\n      list.push(comment)\n    }\n    const { pageClass } = this.state\n    return <div className={pageClass}>{list}</div>\n  };\n\n  generateCommentComponent = (node) => {\n    const { commentID } = this.props\n    const { content, name, blog } = node\n    const iconUrl = node.icon_url\n    const createDate = node.create_date\n    const currentCommentID = node.comment_id\n    const component = (\n      <Comment\n        key={currentCommentID}\n        commentId={currentCommentID}\n        content={content}\n        name={name}\n        iconUrl={iconUrl}\n        showReply={commentID === currentCommentID}\n        blog={blog}\n        createDate={createDate}\n        clickReply={this.onClickReply}\n        subcomponent={node.children}\n        onClickConfirm={this.onClickConfirm}\n      />\n    )\n    return component\n  };\n\n  onLoginSuccess = () => {\n    toast('愉快的py吧！', {\n      position: toast.POSITION.BOTTOM_CENTER,\n    })\n    this.setState({\n      login: null,\n    })\n  };\n\n  onLoginCancel = () => {\n    this.setState({\n      login: null,\n    })\n  };\n\n  onLoginFailure = (errormsg) => {\n    toast(errormsg, {\n      position: toast.POSITION.BOTTOM_CENTER,\n    })\n  };\n\n  generateCommentNodeTree = () => {\n    const { comments } = this.props\n    if (comments === null || comments.length === 0) {\n      return null\n    }\n\n    const root = { parent_id: -1, children: [] }\n\n    const map = {}\n    map[-1] = root\n    Object.keys(comments).forEach((index) => {\n      const comment = comments[index]\n      comment.children = []\n      const commentId = comment.comment_id\n      if (commentId !== undefined) {\n        map[commentId] = comment\n      }\n    })\n    Object.keys(comments).forEach((index) => {\n      const comment = comments[index]\n      const parentId = comment.parent_id\n      const parent = map[parentId]\n      parent.children.push(comment)\n    })\n    return root\n  };\n\n  render() {\n    const { args, displayLoading, content } = this.props\n    const { login, pageClass } = this.state\n    articleObject = args\n    return (\n      <div>\n        <div className={pageClass}>\n          <Loading show={displayLoading} />\n          <div dangerouslySetInnerHTML={{ __html: marked(content) }} />\n        </div>\n        <div className={pageClass}>\n          <Reply clickConfirm={this.onClickConfirm} />\n        </div>\n        {this.getComments()}\n        {this.getFooter()}\n        {login}\n        <ToastContainer\n          autoClose={1000}\n          closeButton={<div />}\n          hideProgressBar\n        />\n      </div>\n    )\n  }\n}\n\nArticle.propTypes = {\n  dispatch: PropTypes.func,\n  content: PropTypes.string,\n  params: PropTypes.object, // eslint-disable-line react/forbid-prop-types\n  args: PropTypes.object, // eslint-disable-line react/forbid-prop-types\n  displayLoading: PropTypes.number,\n  comments: PropTypes.array, // eslint-disable-line react/forbid-prop-types\n  commentID: PropTypes.number,\n  isLoggedin: PropTypes.bool,\n}\n\nArticle.defaultProps = {\n  dispatch: {},\n  params: {},\n  args: {},\n  content: '',\n  displayLoading: 1,\n  comments: [],\n  commentID: -1,\n  isLoggedin: false,\n}\n\nfunction mapStateToProps(state, ownProps) {\n  const getShow = () => {\n    const articleId = ownProps.params.id\n    if (state.request[articleId]) {\n      return 0\n    }\n    return 1\n  }\n  const getContent = () => {\n    const articleId = ownProps.params.id\n    if (state.request[articleId]) {\n      return state.request[articleId].content\n    }\n    return ''\n  }\n\n  const getArgs = () => {\n    const articleId = ownProps.params.id\n    if (state.request[articleId]) {\n      return state.request[articleId]\n    }\n    return {}\n  }\n  const getComments = () => {\n    const articleId = ownProps.params.id\n    if (state.request[articleId]) {\n      return state.request[articleId].comments\n    }\n    return []\n  }\n  const getCommentID = () => {\n    const { commentID } = state.reply\n    if (commentID === undefined) {\n      return -1\n    }\n    return commentID\n  }\n\n  // 获取登录状态\n  const getLoginStatus = () => {\n    const storage = window.localStorage\n    // 获取storage中缓存的uuid\n    const { uuid } = storage\n    if (uuid === undefined || uuid.length === 0) {\n      if (state.request.register === undefined) {\n        return false\n      }\n      // 获取从登录response中获得的uuid\n      const suuid = state.request.register.uuid\n      if (suuid === undefined || suuid.length === 0) {\n        return false\n      }\n      storage.uuid = suuid\n    }\n    return true\n  }\n  return {\n    content: getContent(),\n    displayLoading: getShow(),\n    args: getArgs(),\n    comments: getComments(),\n    commentID: getCommentID(),\n    isLoggedin: getLoginStatus(),\n  }\n}\n\nexport default connect(mapStateToProps)(Article)\n"]},"metadata":{},"sourceType":"module"}